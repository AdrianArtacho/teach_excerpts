<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Visualizer â€“ Roll â†‘ | Score â†” | Keyboard â†“ + MusicXML BPM</title>
  <link rel="stylesheet" href="./style.css" />

  <!-- (Optional) Magenta MIDI helpers -->
  <script type="module">
    try {
      const core = await import('./core.js');
      const midi = await import('./midi_io.js');
      window.mm = { ...core, ...midi };
    } catch (e) {
      console.warn('Magenta modules not loaded (ok for MusicXML-only).', e);
    }
  </script>

  <!-- Local copies -->
  <script defer src="./opensheetmusicdisplay.min.js?v=20251001"></script>
  <script defer src="./all-around-keyboard.min.js?v=20251001"></script>

  <!-- App code -->
  <script defer src="./app.js?v=20251001"></script>
</head>
<body>
  <!-- Title is replaceable via ?title=... (emoji stays) -->
  <h1 id="titleLine">ğŸ¹ <span id="titleText">Visualizer â€“ Roll â†‘ | Score â†” | Keyboard â†“</span></h1>

  <div class="card" id="dropZone">
    <!-- Controls (no visible XML button now) -->
    <div class="row">
      <button id="play" disabled>Play</button>
      <button id="stop" disabled>Stop</button>
      <label><input id="loop" type="checkbox"> Loop</label>
      <label><strong>Tempo:</strong> <span id="bpmVal">100</span> BPM</label>
      <input id="bpm" type="range" min="30" max="240" step="1" value="100">
      <button id="testTone">ğŸ”Š Test Tone</button>
      <button id="panic">â¹ Panic</button>
      <!-- Hidden file input kept for â€œjust in caseâ€ (trigger via keyboard â€˜oâ€™ or click the roll) -->
      <input id="xmlFile" type="file" accept=".musicxml,.xml,.mxl" style="display:none">
    </div>

    <!-- ORDER: Roll (top) -->
    <canvas id="roll"></canvas>

    <!-- Score (middle) -->
    <div id="osmd"><p class="small">Tipp: Ziehe eine MusicXML-Datei hierher (oder drÃ¼cke â€œoâ€), um sie zu laden.</p></div>

    <!-- Keyboard (bottom) -->
    <all-around-keyboard id="kb" octaves="2" width="900" depth="120"></all-around-keyboard>

    <h3>Status</h3>
    <div id="status"></div>
  </div>
</body>
</html>
